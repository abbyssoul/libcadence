EXAMPLES_BIN = ../$(BUILD_DIR)/bin
EXAMPLES_BUILD = ../$(BUILD_DIR)/examples

LOCAL_CPPFLAGS = $(patsubst -I%,-I../%,$(CPPFLAGS))
LOCAL_LDFLAGS = $(patsubst -L%,-L../%,$(LDFLAGS)) -fwhole-program
LDLIBS += -pthread


all: $(EXAMPLES_BIN)/async_server $(EXAMPLES_BIN)/async_serial $(EXAMPLES_BIN)/serial


$(EXAMPLES_BUILD):
	@mkdir -p $@

$(EXAMPLES_BIN):
	@mkdir -p $@

$(EXAMPLES_BUILD)/%.o: %.cpp
	@mkdir -p $(dir $@)
	$(CXX) -c $(CXXFLAGS) $(LOCAL_CPPFLAGS) -o $@ $<


#-------------------------------------------------------------------------------
# Cleanup
#-------------------------------------------------------------------------------

.PHONY: clean
clean:
	$(RM) -rf $(EXAMPLES_BIN)/async_server $(EXAMPLES_BIN)/async_serial

#-------------------------------------------------------------------------------
# Examples:
#-------------------------------------------------------------------------------

# sync_serial
$(EXAMPLES_BIN)/serial: $(EXAMPLES_BUILD)/serial.o $(EXAMPLES_BIN)
	$(CXX) -o $@ $(LOCAL_CXXFLAGS) $< $(LOCAL_LDFLAGS) $(LDLIBS)

# Async_serial
$(EXAMPLES_BIN)/async_serial: $(EXAMPLES_BUILD)/async_serial.o $(EXAMPLES_BIN)
	$(CXX) -o $@ $(LOCAL_CXXFLAGS) $< $(LOCAL_LDFLAGS) $(LDLIBS)

# async_server
$(EXAMPLES_BIN)/async_server: $(EXAMPLES_BUILD)/async_server.o $(EXAMPLES_BIN)
	$(CXX) -o $@ $(LOCAL_CXXFLAGS) $< $(LOCAL_LDFLAGS) $(LDLIBS)
